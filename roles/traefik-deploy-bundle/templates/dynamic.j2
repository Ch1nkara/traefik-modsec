http:
  routers:
{% if enable_http %}
    router_http:
      entryPoints:
      - web
      middlewares : 
        - washing_machine
      service: endpoint_website_http
      rule: "Host(`{{ inventory_hostname }}`)"
{% endif %}
{% if enable_tls %}
    router_tls:
      entryPoints:
      - websecure
      middlewares : 
        - washing_machine
      service: endpoint_website_https
      rule: "Host(`{{ inventory_hostname }}`)"
      tls: {}
{% endif %}

  middlewares:
    washing_machine:
      plugin:
        modsec_plugin:
          modSecurityUrl: "{{ centralized_waf_url }}"

  services:
    endpoint_website_http:
      loadBalancer:
        servers:
        - url: "{{ backend_url_http }}"
    endpoint_website_https:
      loadBalancer:
        servers:
        - url: "{{ backend_url_https }}"

{% if enable_tls %}
tls:
  certificates:
    - certFile: "/srv/certs/{{ inventory_hostname }}_cert.crt"
      keyFile: "/srv/certs/{{ inventory_hostname }}_key.crt"
{% endif %}
